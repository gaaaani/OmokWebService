<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>오조은목</title>
  <link rel="stylesheet" href="../resources/static/css/layout.css">
  <link rel="stylesheet" href="../resources/static/css/game.css">
  <link rel="stylesheet" href="../resources/static/css/reset.css">

</head>

<body>
  <div id="wrapper">
    <div id="header">
      <div id="title-bar">
        <span>5조은목</span>
        <!-- <img id="chat-icon" src="chat.png" alt="채팅"> -->
      </div>
    </div>

    <div id="omok-board"></div>

    <div class="info-panel">
      <div class="info-panel-inside">
        <div id="player-info">
          <div id="left-user">
            <div class="avatar-bg" style="background-color: #F8BBD0;">
              <img src="../resources/static/img/lay.png" alt="부엉이" id="leftUser">
            </div>
            <div class="name-stone">
              <span class="player-name">부엉이</span>
              <span class="stone">⚫</span>
            </div>
            <div class="score">오목조목링 9514점</div>
          </div>

          <div id="timer">
            <span id="left-time">30</span> ⏱ <span id="right-time">30</span>
          </div>


          <div id="right-user">
            <div class="avatar-bg" style="background-color: #E9E9E9;">
              <img src="../resources/static/img/sol.png" alt="곰돌이" id="rightUser">
            </div>
            <div class="name-stone">
              <span class="player-name">곰돌이</span>
              <span class="stone">⚪</span>
            </div>
            <div class="score">오목조목킹 9514점</div>
          </div>
        </div>
        <button id="move-button">착수</button>
      </div>
      <button id="exit-button">나가기</button>
    </div>



    <div id="popup-overlay">
      <!-- 1) 나가기 확인 팝업 -->
      <div id="exit-popup" class="popup-box">
        <p>지금 나가면 항복처리 됩니다.</p>
        <button class="popup-button" onclick="closeAllPopups()">취소</button>
        <button class="popup-button" onclick="confirmExit()">나가기</button>
      </div>

      <!-- 2) 승리 팝업 -->
      <div id="winner-popup" class="popup-box">
        <h2>WIN !!</h2>
        <div>
          <div class="avatar-bg" style="background-color: #E9E9E9;">
            <img src="../resources/static/img/lay.png" alt="win" class="popup-avatar" id="winner-img">
          </div>
          <p id="winner-text">부엉이 🏆 +100점!!</p>
        </div>
        <div class="divider"></div>
        <button class="popup-button" onclick="closeAllPopups()">나가기</button>
      </div>

      <!-- 3) 패배 팝업 -->
      <div id="loser-popup" class="popup-box">
        <div class="avatar-bg" style="background-color: #F8BBD0;">
          <img src="../resources/static/img/sol.png" alt="lose" class="popup-avatar" id="lose-img">
        </div>
        <h2>LOSE !!</h2>
        <p id="loser-text">곰돌이 😢 −100점!!</p>
        <div class="divider"></div>
        <button class="popup-button" onclick="closeAllPopups()">나가기</button>
      </div>

    </div>

  </div>

  <script>
    /*
    타이머 기능
    */
    // 1) 타이머 초기값 및 변수
    let leftTime = 30;
    let rightTime = 30;
    let current = 'left';   // 'left' 또는 'right'
    let timerId = null;

    // 2) 디스플레이 요소 참조
    const leftDisplay = document.getElementById('left-time');
    const rightDisplay = document.getElementById('right-time');
    const moveBtn = document.getElementById('move-button');
    const exitBtn = document.getElementById('exit-button');

    // 3) 화면에 시간 업데이트
    function updateDisplays() {
      leftDisplay.textContent = leftTime;
      rightDisplay.textContent = rightTime;
    }

    // 4) 타이머 시작
    function startTimer() {
      if (timerId) clearInterval(timerId);
      timerId = setInterval(() => {
        if (current === 'left') {
          leftTime--;
          if (leftTime <= 0) return onTimeout('left');
        } else {
          rightTime--;
          if (rightTime <= 0) return onTimeout('right');
        }
        updateDisplays();
      }, 1000);
      updateDisplays();
    }

    // 5) 타임아웃 처리
    function onTimeout(player) {
      clearInterval(timerId);
      alert(`${player === 'left' ? '부엉이' : '곰돌이'} 시간이 초과되었습니다.`);
      switchTurn();
    }

    // 6) 턴 전환 및 시간 리셋
    function switchTurn() {
      if (current === 'left') leftTime = 30;
      else rightTime = 30;
      current = (current === 'left') ? 'right' : 'left';
      startTimer();
    }

    // 7) “착수” 버튼 클릭 시 턴 전환
    moveBtn.addEventListener('click', () => {
      clearInterval(timerId);
      switchTurn();
    });

    // 8) 페이지 로드 시 타이머 시작
    window.addEventListener('load', startTimer);

    /*
    팝업 제어 함수 모음
    */

    // 모든 팝업 닫기
    function closeAllPopups() {
      document.getElementById('popup-overlay').style.display = 'none';
      ['exit-popup', 'winner-popup', 'loser-popup'].forEach(id => {
        document.getElementById(id).style.display = 'none';
      });
    }

    // — 1) 나가기 확인 팝업 열기
    function showExitPopup() {
      document.getElementById('popup-overlay').style.display = 'block';
      document.getElementById('exit-popup').style.display = 'block';
    }

    // — 2) 나가기(항복) 처리
    function confirmExit() {
      closeAllPopups();
      alert('항복 처리되었습니다.');
      // TODO: 서버에 결과 전송 or 페이지 이동 로직 추가
    }

    // — 3) 승리 팝업 열기
    // player: '부엉이' or '곰돌이', delta: 점수 변화값(숫자)
    function showWinnerPopup(player, delta) {
      document.getElementById('popup-overlay').style.display = 'block';
      document.getElementById('winner-text').textContent = `${player} 🏆 +${delta}점!!`;
      document.getElementById('winner-popup').style.display = 'block';
    }

    // — 4) 패배 팝업 열기
    function showLoserPopup(player, delta) {
      document.getElementById('popup-overlay').style.display = 'block';
      document.getElementById('loser-text').textContent = `${player} 😢 −${delta}점!!`;
      document.getElementById('loser-popup').style.display = 'block';
    }

    // — 5) 게임 종료 시 호출하는 함수
    // winner: 'left' or 'right'
    function onGameEnd(winner) {
      clearInterval(timerId);
      if (winner === 'left') {
        showWinnerPopup('부엉이', 100);
      } else {
        showLoserPopup('곰돌이', 100);
      }
    }

    // “나가기” 버튼에 팝업 연결
    exitBtn.addEventListener('click', showExitPopup);
  </script>

</body>

</html>